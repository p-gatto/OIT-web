<div class="animate-fade-in">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Web Links</h1>
        <p class="text-gray-600 text-lg">Gestisci e organizza i tuoi link preferiti</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center py-20">
        <mat-spinner></mat-spinner>
    </div>

    <!-- Tabs -->
    <mat-tab-group *ngIf="!loading" [selectedIndex]="selectedTabIndex" (selectedTabChange)="onTabChange($event)"
        class="mb-6" dynamicHeight>
        <!-- Most Used Tab -->
        <mat-tab label="Più Utilizzati">
            <ng-template matTabContent>
                <div class="py-6">
                    <div class="mb-4 flex items-center">
                        <mat-icon class="text-green-600 mr-2">trending_up</mat-icon>
                        <h2 class="text-xl font-semibold text-gray-800">I 10 Link Più Utilizzati</h2>
                    </div>

                    <div *ngIf="mostUsedLinks.length > 0; else noLinksMessage"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <mat-card *ngFor="let link of mostUsedLinks; let i = index; trackBy: trackByLink"
                            class="cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-lg animate-slide-up"
                            (click)="openLink(link)">
                            <mat-card-header class="pb-2">
                                <div class="flex items-start justify-between w-full">
                                    <div class="flex-1 min-w-0 mr-2">
                                        <mat-card-title class="text-lg font-semibold text-gray-800 truncate"
                                            [matTooltip]="link.title">
                                            {{ link.title }}
                                        </mat-card-title>
                                        <mat-card-subtitle class="text-sm text-gray-600 mt-1">
                                            {{ link.category }} • {{ link.subCategory }}
                                        </mat-card-subtitle>
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span
                                            class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full mb-1">
                                            #{{ i + 1 }}
                                        </span>
                                        <mat-icon *ngIf="link.isFavorite" class="text-red-500 text-sm"
                                            matTooltip="Preferito">
                                            favorite
                                        </mat-icon>
                                    </div>
                                </div>
                            </mat-card-header>

                            <mat-card-content class="py-2">
                                <p *ngIf="link.description" class="text-gray-600 text-sm mb-3 line-clamp-2">
                                    {{ link.description }}
                                </p>

                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span class="flex items-center">
                                        <mat-icon class="text-xs mr-1">bar_chart</mat-icon>
                                        {{ link.usageCount }} utilizzi
                                    </span>
                                    <span class="flex items-center">
                                        <mat-icon class="text-xs mr-1">access_time</mat-icon>
                                        {{ formatDate(link.lastUsed) }}
                                    </span>
                                </div>
                            </mat-card-content>

                            <mat-card-actions class="pt-2">
                                <div class="flex justify-between items-center w-full">
                                    <mat-chip class="text-xs">{{ link.area }}</mat-chip>
                                    <div class="flex gap-1">
                                        <!-- Pulsante per aprire SENZA tracking (semplice visualizzazione) -->
                                        <button mat-icon-button matTooltip="Visualizza link"
                                            (click)="openLink(link, $event)" class="text-blue-500">
                                            <mat-icon>visibility</mat-icon>
                                        </button>

                                        <!-- Pulsante per aprire CON tracking (uso effettivo) -->
                                        <button mat-icon-button matTooltip="Apri e conta utilizzo"
                                            (click)="openLinkWithTracking(link, $event)" class="text-green-600">
                                            <mat-icon>open_in_new</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </mat-card-actions>

                        </mat-card>
                    </div>
                </div>
            </ng-template>
        </mat-tab>

        <!-- Favorites Tab -->
        <mat-tab label="Preferiti">
            <ng-template matTabContent>
                <div class="py-6">
                    <div class="mb-4 flex items-center">
                        <mat-icon class="text-red-600 mr-2">favorite</mat-icon>
                        <h2 class="text-xl font-semibold text-gray-800">I Tuoi Link Preferiti</h2>
                    </div>

                    <div *ngIf="favoriteLinks.length > 0; else noLinksMessage"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <mat-card *ngFor="let link of favoriteLinks; trackBy: trackByLink"
                            class="cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-lg animate-slide-up border-l-4 border-red-500"
                            (click)="openLink(link)">
                            <mat-card-header class="pb-2">
                                <div class="flex items-start justify-between w-full">
                                    <div class="flex-1 min-w-0 mr-2">
                                        <mat-card-title class="text-lg font-semibold text-gray-800 truncate"
                                            [matTooltip]="link.title">
                                            {{ link.title }}
                                        </mat-card-title>
                                        <mat-card-subtitle class="text-sm text-gray-600 mt-1">
                                            {{ link.category }} • {{ link.subCategory }}
                                        </mat-card-subtitle>
                                    </div>
                                    <mat-icon class="text-red-500 animate-bounce-gentle">favorite</mat-icon>
                                </div>
                            </mat-card-header>

                            <mat-card-content class="py-2">
                                <p *ngIf="link.description" class="text-gray-600 text-sm mb-3 line-clamp-2">
                                    {{ link.description }}
                                </p>

                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span class="flex items-center">
                                        <mat-icon class="text-xs mr-1">bar_chart</mat-icon>
                                        {{ link.usageCount }} utilizzi
                                    </span>
                                    <span class="flex items-center">
                                        <mat-icon class="text-xs mr-1">access_time</mat-icon>
                                        {{ formatDate(link.lastUsed) }}
                                    </span>
                                </div>
                            </mat-card-content>

                            <mat-card-actions class="pt-2">
                                <div class="flex justify-between items-center w-full">
                                    <mat-chip class="text-xs">{{ link.area }}</mat-chip>
                                    <div class="flex gap-1">
                                        <!-- Pulsante per aprire SENZA tracking (semplice visualizzazione) -->
                                        <button mat-icon-button matTooltip="Visualizza link"
                                            (click)="openLink(link, $event)" class="text-blue-500">
                                            <mat-icon>visibility</mat-icon>
                                        </button>

                                        <!-- Pulsante per aprire CON tracking (uso effettivo) -->
                                        <button mat-icon-button matTooltip="Apri e conta utilizzo"
                                            (click)="openLinkWithTracking(link, $event)" class="text-green-600">
                                            <mat-icon>open_in_new</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </mat-card-actions>
                        </mat-card>
                    </div>
                </div>
            </ng-template>
        </mat-tab>

        <!-- Recent Tab -->
        <mat-tab label="Recenti">
            <ng-template matTabContent>
                <div class="py-6">
                    <div class="mb-4 flex items-center">
                        <mat-icon class="text-blue-600 mr-2">schedule</mat-icon>
                        <h2 class="text-xl font-semibold text-gray-800">Ultimi 10 Link Visitati</h2>
                    </div>

                    <div *ngIf="recentLinks.length > 0; else noLinksMessage"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <mat-card *ngFor="let link of recentLinks; trackBy: trackByLink"
                            class="cursor-pointer transform transition-all duration-300 hover:scale-105 hover:shadow-lg animate-slide-up border-l-4 border-blue-500"
                            (click)="openLink(link)">
                            <mat-card-header class="pb-2">
                                <div class="flex items-start justify-between w-full">
                                    <div class="flex-1 min-w-0 mr-2">
                                        <mat-card-title class="text-lg font-semibold text-gray-800 truncate"
                                            [matTooltip]="link.title">
                                            {{ link.title }}
                                        </mat-card-title>
                                        <mat-card-subtitle class="text-sm text-gray-600 mt-1">
                                            {{ link.category }} • {{ link.subCategory }}
                                        </mat-card-subtitle>
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <mat-icon class="text-blue-500 text-sm mb-1">access_time</mat-icon>
                                        <mat-icon *ngIf="link.isFavorite" class="text-red-500 text-sm"
                                            matTooltip="Preferito">
                                            favorite
                                        </mat-icon>
                                    </div>
                                </div>
                            </mat-card-header>

                            <mat-card-content class="py-2">
                                <p *ngIf="link.description" class="text-gray-600 text-sm mb-3 line-clamp-2">
                                    {{ link.description }}
                                </p>

                                <div class="flex items-center justify-between text-xs text-gray-500">
                                    <span class="flex items-center">
                                        <mat-icon class="text-xs mr-1">bar_chart</mat-icon>
                                        {{ link.usageCount }} utilizzi
                                    </span>
                                    <span class="flex items-center font-semibold text-blue-600">
                                        <mat-icon class="text-xs mr-1">schedule</mat-icon>
                                        {{ formatDate(link.lastUsed) }}
                                    </span>
                                </div>
                            </mat-card-content>

                            <mat-card-actions class="pt-2">
                                <div class="flex justify-between items-center w-full">
                                    <mat-chip class="text-xs">{{ link.area }}</mat-chip>
                                    <div class="flex gap-1">
                                        <!-- Pulsante per aprire SENZA tracking (semplice visualizzazione) -->
                                        <button mat-icon-button matTooltip="Visualizza link"
                                            (click)="openLink(link, $event)" class="text-blue-500">
                                            <mat-icon>visibility</mat-icon>
                                        </button>

                                        <!-- Pulsante per aprire CON tracking (uso effettivo) -->
                                        <button mat-icon-button matTooltip="Apri e conta utilizzo"
                                            (click)="openLinkWithTracking(link, $event)" class="text-green-600">
                                            <mat-icon>open_in_new</mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </mat-card-actions>
                        </mat-card>
                    </div>
                </div>
            </ng-template>
        </mat-tab>
    </mat-tab-group>

    <!-- No Links Message Template -->
    <ng-template #noLinksMessage>
        <div class="text-center py-12">
            <mat-icon class="text-6xl text-gray-300 mb-4">link_off</mat-icon>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">Nessun link trovato</h3>
            <p class="text-gray-500">Non ci sono link disponibili in questa categoria.</p>
        </div>
    </ng-template>
</div>